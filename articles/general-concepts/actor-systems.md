# Actor 系统
Actor 是封装状态和行为的对象，它们仅能通过收件人邮箱中的消息进行通信交换。从某种意义上说，Actor 是面向对象编程最严格的形式，但最好将其视为“人”：当与 Actor 一起建模解决方案时，设想一组人员并为其分配子任务，将其功能安排到组织结构中，并考虑如何升级失败（所有这些都得益于非实际地与人打交道，这意味着我们不需要关心他们的情感状态或道德问题）。结果可以作为构建软件实现的一个心理脚手架（`mental scaffolding`）。

- **注释**：`ActorSystem`是一个重量级架构，它负责（为应用程序）分配`1 … N`个线程，所以每个应用逻辑都拥有一个（`ActorSystem`）。

## 层次结构
就像在经济组织中一样，Actor 自然形成等级制度。一个负责监督程序中某个函数的 Actor 可能希望将其任务拆分为更小、更易于管理的部分。为此，它启动了由它监督的子 Actor。

Actor 系统的典型特征是任务被拆分和委托，直到它们变得足够小，可以一块处理。这样做，不仅任务本身结构清晰，而且可以导致 Actor 能够推理它们应该处理哪些消息、如何正常反应或应该处理何种失败。

将此与为了不泄漏任何故障的分层软件设计进行比较，后者很容易演变为防御性编程：相比将所有事情“隐藏”在“地毯下”更好的解决方案是如何将问题传达给正确的人。

现在，设计这样一个系统的困难在于如何决定谁应该监督什么。没有单一的最佳解决方案，但有一些指导方针可能会有所帮助：

- 如果一个 Actor 携带非常重要的数据（即，如果可能让其状态不丢失），则该 Actor 应为其监督的子 Actor 找出任何可能危险的子任务，并处理这些子 Actor 的故障。根据请求的性质，最好为每个请求创建一个新的子级，这样可以简化收集回复的状态管理。这就是 Erlang 的“错误内核模式”。
- 如果一个 Actor 依靠另一个 Actor 来履行职责（`carrying out its duty`），它应该观察（`watch`）另一个 Actor 的活动，并在接到终止通知后采取行动。
- 如果一个 actor 有多个职责，每个职责通常可以被推到一个单独的子节点中，以使逻辑和状态更简单。

## 配置容器

Actor 系统作为 Actor 的协作集合，是管理共享设施（如调度服务、配置、日志记录等）的自然单元。具有不同配置的多个 Actor 系统可以在同一个 JVM 中共存且不导致问题，Akka 本身没有全局共享状态，哪怕通常每个 JVM 只有一个 actor 系统。

## 最佳实践

 1. Actor 应该像好的同事一样：高效地工作，避免不必要地打扰其他人，并且避免占用资源。翻译成编程语言，这意味着以事件驱动的方式处理事件并生成响应（或更多请求）。Actor 不应在可能是锁、网络套接字等外部实体上阻塞，即占用线程时被动等待，除非这是不可避免的；对于后一种情况，请参见[小心地管理阻塞](../typed/dispatchers.md#小心地管理阻塞)一文。
 2. 不要在 Actor 之间传递可变对象。为了确保这一点，最好选择不可变的消息。如果将它们的可变状态暴露到外部来破坏 Actor 的封装，就会返回到传统的 Java 并发编程领域，并具有所有的那些缺点。
 3. Actor 被设计成行为和状态的容器，接受这一点意味着不要在消息中发送行为（使用 Scala 闭包可能很诱人）。其中一个风险是不小心在 Actor 之间共享可变状态，而这种对 Actor 模型的违反不幸地破坏了所有使actor 中的编程体验如此美好的属性。
 4. 顶级 Actor 是错误内核的最核心部分，它应该只负责启动你的应用程序的各个子系统，本身不包含太多逻辑，并且更倾向于真正的分层系统。这对于故障处理（同时考虑配置的粒度和性能）有好处，而且它还减少了对守护者 Actor 的压力，如果使用过度会形成一个单点争用。

## 你不应该关心的事
Actor 系统管理配置给它的资源以运行其包含的 Actor。在一个这样的系统中，可能有数百万的 Actor，并且他们在每个实例的开销只有大约 300 字节，这对于所有的评价都可视其为丰富。虽然在大型系统中处理这些消息的确切顺序不受应用程序作者的控制，但这是无需在意的。退后一步放松一下，就让 Akka 在幕后去做这些繁重的工作吧。

## 终止ActorSystem

当你知道应用程序的所有操作都已完成时，可以让user guardian actor停止，或调`ActorSystem`的`terminate`方法。这将执行  [`CoordinatedShutdown`](../actors/coordinated-shutdown.md) 终止所有actor 的运行。

如果要在终止`ActorSystem`时终止时执行某些操作，请查看  [`CoordinatedShutdown`](../actors/coordinated-shutdown.md) 。

----------

[什么是Actor？](actors.md)

----------
**英文原文链接**：[Actor Systems](https://doc.akka.io/docs/akka/current/general/actor-systems.html).